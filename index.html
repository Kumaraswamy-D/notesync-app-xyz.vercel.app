<!DOCTYPE html>
<html>
<head>
<title>ğŸ’– NoteSync Ultimate ğŸ’–</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#ff6a88,#ff99ac);
color:white;
text-align:center;
overflow-x:hidden;
}

.section{display:none;padding:15px;}

.card{
background:white;
color:black;
padding:15px;
border-radius:20px;
margin:10px;
}

#chatBox{
height:260px;
overflow-y:auto;
background:white;
color:black;
border-radius:15px;
padding:10px;
text-align:left;
}

input,button{
padding:8px;
margin:5px;
border-radius:20px;
border:none;
}

.bottomNav{
position:fixed;
bottom:0;
width:100%;
background:#ff4d6d;
display:flex;
justify-content:space-around;
padding:10px 0;
}

.bottomNav button{
background:none;
color:white;
font-size:18px;
}

.heart{
position:fixed;
color:white;
animation:float 6s linear infinite;
}

@keyframes float{
from{transform:translateY(100vh);}
to{transform:translateY(-10vh);}
}

.balloon{
position:fixed;
bottom:-100px;
font-size:30px;
animation:fly 5s linear forwards;
}

@keyframes fly{
to{transform:translateY(-800px);}
}
</style>
</head>
<body>

<h2>ğŸ’– NoteSync Ultimate ğŸ’–</h2>

<div id="loginDiv">
<input type="email" id="email" placeholder="Email"><br>
<input type="password" id="password" placeholder="Password"><br>
<button id="loginBtn">Login</button>
</div>

<div id="mainDiv" style="display:none;">

<div id="home" class="section">
<div class="card">
<h3>Kumaraswamy ğŸ’™ & Pooja ğŸ’–</h3>
<p id="statusText"></p>
<p id="daysTogether"></p>
<p id="birthdayCountdown"></p>
<p id="anniCountdown"></p>
</div>
</div>

<div id="chat" class="section">
<div id="chatBox"></div>
<p id="typingText"></p>
<input type="text" id="messageInput" placeholder="Type message">
<button id="sendBtn">Send</button>
</div>

<div id="celebration" class="section">
<button onclick="cutCake()">ğŸ‚ Cut Cake</button>
<button onclick="balloonBlast()">ğŸˆ Balloon Blast</button>
</div>

<div class="bottomNav">
<button onclick="showSection('home')">ğŸ </button>
<button onclick="showSection('chat')">ğŸ’¬</button>
<button onclick="showSection('celebration')">ğŸ‰</button>
<button id="logoutBtn">ğŸšª</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, setDoc, updateDoc }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyDEl579k9r9NxIVss_QtQTNLoa25CGGSbI",
authDomain:"notesync-5e7ed.firebaseapp.com",
projectId:"notesync-5e7ed",
storageBucket:"notesync-5e7ed.firebasestorage.app",
messagingSenderId:"486342879531",
appId:"1:486342879531:web:76ed522f873d1ecca67d6e"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth();
const db=getFirestore();

const allowedUsers={
"kumaraswamyd2005@gmail.com":"Kumaraswamy ğŸ’™",
"poojaprasanna089@gmail.com":"Pooja ğŸ’–"
};

loginBtn.onclick=()=>signInWithEmailAndPassword(auth,email.value,password.value);
logoutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,async user=>{
if(user && allowedUsers[user.email]){
loginDiv.style.display="none";
mainDiv.style.display="block";
showSection("home");

await setDoc(doc(db,"status",user.email),{online:true});
window.addEventListener("beforeunload",async ()=>{
await setDoc(doc(db,"status",user.email),{online:false});
});
}else{
loginDiv.style.display="block";
mainDiv.style.display="none";
}
});

/* ONLINE STATUS */
onSnapshot(collection(db,"status"),snap=>{
let onlineCount=0;
snap.forEach(d=>{ if(d.data().online) onlineCount++; });
statusText.innerHTML=onlineCount===2
? "ğŸ’š Your soulmate is online"
: "â¤ï¸ Waiting for soulmate...";
});

/* DAYS TOGETHER */
const anniversary=new Date("2023-11-25");
const diff=Math.floor((new Date()-anniversary)/(1000*60*60*24));
daysTogether.innerText="ğŸ’– Days Together: "+diff+" days";

/* BIRTHDAY COUNTDOWN */
function countdown(target,element){
let now=new Date();
let next=new Date(now.getFullYear(),target.getMonth(),target.getDate());
if(next<now) next.setFullYear(now.getFullYear()+1);
let days=Math.ceil((next-now)/(1000*60*60*24));
element.innerText="ğŸ‚ Next Birthday in "+days+" days";
}
countdown(new Date("2005-02-19"),birthdayCountdown);

/* ANNIVERSARY COUNTDOWN */
countdown(new Date("2023-11-25"),anniCountdown);

/* CHAT */
sendBtn.onclick=async()=>{
if(messageInput.value.trim()=="")return;
await addDoc(collection(db,"messages"),{
text:messageInput.value,
user:allowedUsers[auth.currentUser.email],
email:auth.currentUser.email,
time:Date.now(),
seen:false
});
messageInput.value="";
};

const q=query(collection(db,"messages"),orderBy("time"));
onSnapshot(q,snap=>{
chatBox.innerHTML="";
snap.forEach(d=>{
const msg=d.data();
const id=d.id;
chatBox.innerHTML+=`
<p>
<b>${msg.user}:</b> ${msg.text}
${msg.email===auth.currentUser.email?(msg.seen?"âœ”âœ”":"âœ”"):""}
${msg.email===auth.currentUser.email?`<button onclick="deleteMsg('${id}')">ğŸ—‘</button>`:""}
</p>`;
if(msg.email!==auth.currentUser.email && !msg.seen){
updateDoc(doc(db,"messages",id),{seen:true});
}
});
chatBox.scrollTop=chatBox.scrollHeight;
});

window.deleteMsg=id=>deleteDoc(doc(db,"messages",id));

/* TYPING */
messageInput.oninput=()=>setDoc(doc(db,"typing","status"),{user:auth.currentUser.email});
onSnapshot(doc(db,"typing","status"),docSnap=>{
if(docSnap.exists()){
typingText.innerText=
docSnap.data().user!==auth.currentUser.email
? "ğŸ’¬ Your soulmate is typing..."
: "";
}
});

/* CELEBRATION */
window.cutCake=()=>{
if(statusText.innerText.includes("online"))
alert("ğŸ‚ Cake Cut Together ğŸ’–");
else alert("Both must be online!");
};

window.balloonBlast=()=>{
if(statusText.innerText.includes("online")){
for(let i=0;i<10;i++){
let b=document.createElement("div");
b.className="balloon";
b.innerText="ğŸˆ";
b.style.left=Math.random()*100+"%";
document.body.appendChild(b);
setTimeout(()=>b.remove(),5000);
}
}else alert("Both must be online!");
};

/* FLOATING HEARTS */
setInterval(()=>{
let h=document.createElement("div");
h.className="heart";
h.innerText="ğŸ’–";
h.style.left=Math.random()*100+"%";
document.body.appendChild(h);
setTimeout(()=>h.remove(),6000);
},800);

window.showSection=id=>{
document.querySelectorAll(".section").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
};

</script>
</body>
</html>
