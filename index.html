<!DOCTYPE html>
<html>
<head>
  <title>NoteSync</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: Arial;
      background: #0f172a;
      color: gold;
    }

    h2 {
      text-align: center;
      padding: 10px;
    }

    #loginDiv {
      text-align: center;
      margin-top: 80px;
    }

    input {
      padding: 10px;
      margin: 8px;
      border-radius: 8px;
      border: none;
      width: 80%;
    }

    button {
      padding: 10px 20px;
      border-radius: 20px;
      border: none;
      background: gold;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }

    #mainDiv {
      display: none;
      padding-bottom: 70px;
    }

    .section {
      display: none;
      padding: 15px;
    }

    #chatBox {
      height: 250px;
      overflow-y: scroll;
      background: #1e293b;
      padding: 10px;
      border-radius: 10px;
      color: white;
    }

    .bottomNav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #1e293b;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
    }

    .bottomNav button {
      background: none;
      color: gold;
      font-size: 14px;
    }

    .card {
      background: #1e293b;
      padding: 15px;
      border-radius: 12px;
      margin: 10px 0;
      color: white;
    }
  </style>
</head>

<body>

<h2>üíõ NoteSync üíõ</h2>

<div id="loginDiv">
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button id="loginBtn">Login</button>
</div>

<div id="mainDiv">

  <div id="dashboard" class="section">
    <div class="card">
      <h3 id="welcome"></h3>
      <p>‚ù§Ô∏è Together Since: 01 Jan 2024</p>
      <p id="loveDays"></p>
    </div>
  </div>

  <div id="chat" class="section">
    <div id="chatBox"></div>
    <input type="text" id="messageInput" placeholder="Type message">
    <button id="sendBtn">Send</button>
  </div>

  <div id="dates" class="section">
    <input type="text" id="dateTitle" placeholder="Event Name">
    <input type="date" id="dateValue">
    <button onclick="addDate()">Save</button>
    <div id="dateList"></div>
  </div>

  <div class="bottomNav">
    <button onclick="showSection('dashboard')">Home</button>
    <button onclick="showSection('chat')">Chat</button>
    <button onclick="showSection('dates')">Dates</button>
    <button onclick="logout()">Logout</button>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEl579k9r9NxIVss_QtQTNLoa25CGGSbI",
  authDomain: "notesync-5e7ed.firebaseapp.com",
  projectId: "notesync-5e7ed",
  storageBucket: "notesync-5e7ed.firebasestorage.app",
  messagingSenderId: "486342879531",
  appId: "1:486342879531:web:76ed522f873d1ecca67d6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const allowedUsers = {
  "kumaraswamyd2005@gmail.com": "Kumaraswamy üíô",
  "poojaprasanna089@gmail.com": "Pooja üíñ"
};

document.getElementById("loginBtn").onclick = async () => {
  const email = emailInput.value;
  const password = passwordInput.value;
  try {
    const userCred = await signInWithEmailAndPassword(auth,email,password);
    if(!allowedUsers[email]){
      alert("Access Denied");
      await signOut(auth);
    }
  } catch(err){
    alert(err.message);
  }
};

onAuthStateChanged(auth,user=>{
  if(user && allowedUsers[user.email]){
    loginDiv.style.display="none";
    mainDiv.style.display="block";
    welcome.innerText="Welcome "+allowedUsers[user.email];
    showSection("dashboard");

    const startDate=new Date("2024-01-01");
    const today=new Date();
    const diff=Math.floor((today-startDate)/(1000*60*60*24));
    loveDays.innerText="‚ù§Ô∏è Love Days: "+diff;
  } else {
    loginDiv.style.display="block";
    mainDiv.style.display="none";
  }
});

window.logout=function(){
  signOut(auth);
};

window.showSection=function(id){
  document.querySelectorAll(".section").forEach(sec=>sec.style.display="none");
  document.getElementById(id).style.display="block";
};

document.getElementById("sendBtn").onclick=async()=>{
  const text=messageInput.value;
  if(text==="") return;
  await addDoc(collection(db,"messages"),{
    text:text,
    user:allowedUsers[auth.currentUser.email],
    time:Date.now()
  });
  messageInput.value="";
};

const q=query(collection(db,"messages"),orderBy("time"));
onSnapshot(q,snap=>{
  chatBox.innerHTML="";
  snap.forEach(doc=>{
    const msg=doc.data();
    chatBox.innerHTML+=`<p><b>${msg.user}:</b> ${msg.text}</p>`;
  });
  chatBox.scrollTop=chatBox.scrollHeight;
});

window.addDate=async()=>{
  if(dateTitle.value===""||dateValue.value==="") return;
  await addDoc(collection(db,"dates"),{
    title:dateTitle.value,
    date:dateValue.value
  });
  dateTitle.value="";
  dateValue.value="";
};

onSnapshot(collection(db,"dates"),snap=>{
  dateList.innerHTML="";
  snap.forEach(doc=>{
    dateList.innerHTML+=`<div class="card">üìÖ ${doc.data().title} - ${doc.data().date}</div>`;
  });
});
</script>

</body>
</html>
