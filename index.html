<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NoteSync ğŸ’–</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#ff758c,#ff7eb3);
  text-align:center;
  color:white;
}
.section{display:none;padding:15px;}
.active{display:block;}
.card{
  background:white;
  color:black;
  margin:10px;
  padding:15px;
  border-radius:15px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
input,button{
  padding:8px;
  margin:5px;
  border-radius:8px;
  border:none;
}
button{
  background:#ff4d6d;
  color:white;
  cursor:pointer;
}
#chatBox{
  height:250px;
  overflow-y:auto;
  background:white;
  color:black;
  padding:10px;
  border-radius:10px;
}
.bottomNav{
  position:fixed;
  bottom:0;
  width:100%;
  background:#ff4d6d;
  padding:10px;
  display:flex;
  justify-content:space-around;
}
.bottomNav button{
  background:white;
  color:#ff4d6d;
  font-weight:bold;
}
</style>
</head>
<body>

<h2>ğŸ’– NoteSync ğŸ’–</h2>

<div id="loginDiv">
<input type="email" id="email" placeholder="Email"><br>
<input type="password" id="password" placeholder="Password"><br>
<button id="loginBtn">Login</button>
</div>

<div id="mainDiv" style="display:none;padding-bottom:70px;">

<!-- HOME -->
<div id="home" class="section active">
<div class="card">
<h2>ğŸ’™ Kumaraswamy â¤ï¸ Pooja ğŸ’–</h2>
<p id="onlineStatus"></p>
</div>

<div class="card">
<h3>ğŸ‚ Birthdays</h3>
<p id="birthday"></p>
</div>

<div class="card">
<h3>ğŸ’ Anniversary</h3>
<p id="anniversaryText"></p>
</div>

<div class="card">
<h3>ğŸ’ Days Together</h3>
<p id="daysTogether"></p>
</div>
</div>

<!-- CHAT -->
<div id="chat" class="section">
<div id="chatBox"></div>
<input type="text" id="messageInput" placeholder="Type message">
<button id="sendBtn">Send</button>
</div>

<!-- IMPORTANT DATES -->
<div id="dates" class="section">
<div class="card">
<input type="text" id="eventTitle" placeholder="Event Name">
<input type="date" id="eventDate">
<button onclick="addEvent()">Add</button>
<div id="eventList"></div>
</div>
</div>

<!-- CELEBRATION -->
<div id="celebration" class="section">
<div class="card">
<button onclick="cutCake()">ğŸ‚ Cut Cake</button>
<p id="celebrateMsg"></p>
</div>
</div>

<!-- SECRET -->
<div id="secret" class="section">
<div class="card">
<input type="text" id="secretInput" placeholder="Write secret message">
<button onclick="addSecret()">Save</button>
<div id="secretList"></div>
</div>
</div>

</div>

<div class="bottomNav" id="navBar" style="display:none;">
<button onclick="showSection('home')">ğŸ </button>
<button onclick="showSection('chat')">ğŸ’¬</button>
<button onclick="showSection('dates')">ğŸ“…</button>
<button onclick="showSection('celebration')">ğŸ‰</button>
<button onclick="showSection('secret')">ğŸ’Œ</button>
<button id="logoutBtn">ğŸšª</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* YOUR FIREBASE CONFIG */
const firebaseConfig = {
apiKey:"AIzaSyDEl579k9r9NxIVss_QtQTNLoa25CGGSbI",
authDomain:"notesync-5e7ed.firebaseapp.com",
projectId:"notesync-5e7ed",
storageBucket:"notesync-5e7ed.firebasestorage.app",
messagingSenderId:"486342879531",
appId:"1:486342879531:web:76ed522f873d1ecca67d6e"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth();
const db=getFirestore();

const allowedUsers={
"kumaraswamyd2005@gmail.com":"Kumaraswamy ğŸ’™",
"poojaprasanna089@gmail.com":"Pooja ğŸ’–"
};

/* LOGIN */
loginBtn.onclick=async()=>{
try{
await signInWithEmailAndPassword(auth,email.value,password.value);
}catch(e){alert(e.message);}
};

logoutBtn.onclick=()=>signOut(auth);

/* AUTH STATE */
onAuthStateChanged(auth,user=>{
if(user && allowedUsers[user.email]){
loginDiv.style.display="none";
mainDiv.style.display="block";
navBar.style.display="flex";

setDoc(doc(db,"status",user.uid),{
email:user.email,
online:true
});

loadChat();
loadDates();
loadSecret();
updateDashboard();

}else{
loginDiv.style.display="block";
mainDiv.style.display="none";
navBar.style.display="none";
}
});

/* AUTO OFFLINE */
window.addEventListener("beforeunload", async ()=>{
if(auth.currentUser){
await setDoc(doc(db,"status",auth.currentUser.uid),{
email:auth.currentUser.email,
online:false
});
}
});

/* ONLINE STATUS */
onSnapshot(collection(db,"status"),snap=>{
if(!auth.currentUser) return;
let online=false;
snap.forEach(d=>{
if(d.data().email!==auth.currentUser.email && d.data().online){
online=true;
}
});
onlineStatus.innerHTML=online?"ğŸŸ¢ Soulmate Online":"ğŸ”´ Soulmate Offline";
window.bothOnline=online;
});

/* DASHBOARD */
const myBirthday=new Date("2005-02-19");
const herBirthday=new Date("2004-12-07");
const anniversary=new Date("2023-11-25");

function daysLeft(date){
let now=new Date();
let next=new Date(now.getFullYear(),date.getMonth(),date.getDate());
if(next<now) next.setFullYear(now.getFullYear()+1);
return Math.ceil((next-now)/(1000*60*60*24));
}

function updateDashboard(){
birthday.innerHTML=
`Kumaraswamy: ${daysLeft(myBirthday)} days<br>
Pooja: ${daysLeft(herBirthday)} days`;

anniversaryText.innerHTML=`${daysLeft(anniversary)} days left`;

let days=Math.floor((new Date()-anniversary)/(1000*60*60*24));
daysTogether.innerHTML=`${days} days`;
}

/* CHAT */
sendBtn.onclick=async()=>{
if(messageInput.value==="") return;
await addDoc(collection(db,"messages"),{
text:messageInput.value,
email:auth.currentUser.email,
name:allowedUsers[auth.currentUser.email],
time:Date.now(),
seen:false
});
messageInput.value="";
};

function loadChat(){
onSnapshot(query(collection(db,"messages"),orderBy("time")),async snap=>{
chatBox.innerHTML="";
for(const d of snap.docs){
let m=d.data();

if(auth.currentUser && m.email!==auth.currentUser.email && !m.seen){
await updateDoc(doc(db,"messages",d.id),{seen:true});
}

chatBox.innerHTML+=`
<p>
<b>${m.name}:</b> ${m.text}
${m.email===auth.currentUser.email?(m.seen?" âœ…âœ…":" âœ…"):""}
${m.email===auth.currentUser.email?
`<button onclick="deleteMessage('${d.id}')">ğŸ—‘</button>`:""}
</p>`;
}
chatBox.scrollTop=chatBox.scrollHeight;
});
}

window.deleteMessage=id=>deleteDoc(doc(db,"messages",id));

/* IMPORTANT DATES */
window.addEvent=async()=>{
if(eventTitle.value===""||eventDate.value==="") return;
await addDoc(collection(db,"dates"),{
title:eventTitle.value,
date:eventDate.value
});
eventTitle.value="";eventDate.value="";
};

function loadDates(){
onSnapshot(collection(db,"dates"),snap=>{
eventList.innerHTML="";
snap.forEach(d=>{
let data=d.data();
let days=Math.ceil((new Date(data.date)-new Date())/(1000*60*60*24));
eventList.innerHTML+=`
<p>${data.title} - ${data.date} (${days} days left)
<button onclick="deleteMessage('${d.id}')">ğŸ—‘</button>
</p>`;
});
});
}

/* SECRET */
window.addSecret=async()=>{
if(secretInput.value==="") return;
await addDoc(collection(db,"secret"),{text:secretInput.value});
secretInput.value="";
};

function loadSecret(){
onSnapshot(collection(db,"secret"),snap=>{
secretList.innerHTML="";
snap.forEach(d=>{
secretList.innerHTML+=`<p>ğŸ’Œ ${d.data().text}</p>`;
});
});
}

/* ULTRA CELEBRATION */
window.cutCake=async()=>{
if(!window.bothOnline){
celebrateMsg.innerHTML="Both must be online ğŸ’”";
return;
}
await setDoc(doc(db,"celebration","cake"),{
time:Date.now()
});
};

onSnapshot(doc(db,"celebration","cake"),snap=>{
if(snap.exists()){
celebrateMsg.innerHTML="ğŸ‚ğŸ’– ULTRA CELEBRATION MODE ACTIVATED ğŸ’–ğŸ‰";
}
});

/* NAV */
window.showSection=id=>{
document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
};

</script>
</body>
</html>
