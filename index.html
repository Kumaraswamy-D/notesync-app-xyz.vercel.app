<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Notesync ğŸ’•</title>

<style>
body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#ff758c,#ff7eb3);
  color:white;
  text-align:center;
}

.container{
  padding:20px;
}

h1{
  margin-top:5px;
}

.card{
  background:white;
  color:black;
  padding:15px;
  border-radius:15px;
  margin:10px 0;
}

input,button{
  padding:10px;
  margin:5px;
  border:none;
  border-radius:8px;
}

button{
  background:#ff4d6d;
  color:white;
  cursor:pointer;
}

.nav button{
  margin:5px;
}

.section{
  display:none;
}

.active{
  display:block;
}

#chatBox{
  background:white;
  color:black;
  height:200px;
  overflow-y:auto;
  padding:10px;
  border-radius:10px;
  margin-bottom:10px;
}

#secretBox{
  background:white;
  color:black;
  max-height:200px;
  overflow-y:auto;
  padding:10px;
  border-radius:10px;
}
</style>
</head>

<body>

<div class="container">

<h1>ğŸ’– Kumaraswamy D â¤ï¸ Pooja ğŸ’–</h1>
<p id="statusText">Checking status...</p>

<!-- LOGIN -->
<div id="loginDiv">
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="appDiv" style="display:none;">

<div class="card">
  <h3>ğŸ’ Next Special Day</h3>
  <p id="countdown"></p>
</div>

<div class="nav">
  <button onclick="showSection('chat')">Chat</button>
  <button onclick="showSection('secret')">Secret Messages</button>
  <button onclick="logout()">Logout</button>
</div>

<!-- CHAT -->
<div id="chat" class="section active">
  <div id="chatBox"></div>
  <input type="text" id="message" placeholder="Type message">
  <button onclick="sendMessage()">Send</button>
</div>

<!-- SECRET -->
<div id="secret" class="section">
  <h3>ğŸ’Œ Special Messages</h3>
  <input type="text" id="secretMsg" placeholder="Write special message">
  <button onclick="sendSecret()">Send</button>
  <div id="secretBox"></div>
</div>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEl579k9r9NxIVss_QtQTNLoa25CGGSbI",
  authDomain: "notesync-5e7ed.firebaseapp.com",
  projectId: "notesync-5e7ed",
  storageBucket: "notesync-5e7ed.firebasestorage.app",
  messagingSenderId: "486342879531",
  appId: "1:486342879531:web:76ed522f873d1ecca67d6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const allowedUsers = {
  "kumaraswamyd2005@gmail.com": "Kumaraswamy D â¤ï¸",
  "poojaprasanna089@gmail.com": "Pooja â¤ï¸"
};

// Countdown Logic
function calculateNextEvent(){
  const today = new Date();
  const events = [
    {name:"Kumaraswamy Birthday ğŸ‚", date:new Date(today.getFullYear(),1,19)},
    {name:"Pooja Birthday ğŸ‚", date:new Date(today.getFullYear(),11,7)},
    {name:"Anniversary ğŸ’", date:new Date(today.getFullYear(),10,25)}
  ];

  events.forEach(e=>{
    if(e.date < today){
      e.date.setFullYear(today.getFullYear()+1);
    }
  });

  events.sort((a,b)=>a.date-b.date);

  const diff = Math.ceil((events[0].date - today)/(1000*60*60*24));
  document.getElementById("countdown").innerText =
    events[0].name + " in " + diff + " days ğŸ’–";
}

calculateNextEvent();

window.login = function(){
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;

  if(!allowedUsers[email]){
    alert("Not Allowed");
    return;
  }

  signInWithEmailAndPassword(auth,email,password)
  .catch(err=>alert(err.message));
}

window.logout=function(){
  signOut(auth);
}

window.showSection=function(id){
  document.querySelectorAll(".section").forEach(sec=>sec.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

window.sendMessage=async function(){
  const message=document.getElementById("message").value;
  if(message.trim()==="") return;

  await addDoc(collection(db,"messages"),{
    text:message,
    user:allowedUsers[auth.currentUser.email],
    time:Date.now()
  });

  document.getElementById("message").value="";
}

window.sendSecret=async function(){
  const msg=document.getElementById("secretMsg").value;
  if(msg.trim()==="") return;

  await addDoc(collection(db,"secretMessages"),{
    text:msg,
    time:Date.now()
  });

  document.getElementById("secretMsg").value="";
}

onAuthStateChanged(auth,user=>{
  if(user){
    loginDiv.style.display="none";
    appDiv.style.display="block";

    document.getElementById("statusText").innerText="ğŸŸ¢ Online";

    const q=query(collection(db,"messages"),orderBy("time"));
    onSnapshot(q,snap=>{
      chatBox.innerHTML="";
      snap.forEach(d=>{
        const m=d.data();
        chatBox.innerHTML+=`<p><b>${m.user}:</b> ${m.text}</p>`;
      });
    });

    const s=query(collection(db,"secretMessages"),orderBy("time"));
    onSnapshot(s,snap=>{
      secretBox.innerHTML="";
      snap.forEach(d=>{
        const m=d.data();
        secretBox.innerHTML+=
        `<p>${m.text} 
        <button onclick="deleteSecret('${d.id}')">Clear</button></p>`;
      });
    });

  }else{
    loginDiv.style.display="block";
    appDiv.style.display="none";
    document.getElementById("statusText").innerText="ğŸ”´ Offline";
  }
});

window.deleteSecret=async function(id){
  await deleteDoc(doc(db,"secretMessages",id));
}

</script>

</body>
</html>
