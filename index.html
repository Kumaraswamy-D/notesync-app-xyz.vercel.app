<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NoteSync ğŸ’•</title>

<style>
body{
  margin:0;
  font-family: Arial;
  background: linear-gradient(135deg,#ff758c,#ff7eb3);
  color:white;
  text-align:center;
}

.container{ padding:15px; }

input,button{
  padding:10px;
  margin:5px;
  border:none;
  border-radius:8px;
}

button{
  background:#ff4d6d;
  color:white;
  cursor:pointer;
}

.section{ display:none; }
.active{ display:block; }

#chatBox{
  background:white;
  color:black;
  height:250px;
  overflow-y:auto;
  padding:10px;
  border-radius:10px;
}

.bottomNav{
  position:fixed;
  bottom:0;
  width:100%;
  background:#ff4d6d;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}

.bottomNav button{
  background:none;
  border:none;
  color:white;
  font-size:14px;
}

.online{
  color:#00ff99;
  font-weight:bold;
}

.offline{
  color:#ffcccc;
}
</style>
</head>

<body>
<div class="container">

<h2>ğŸ’– NoteSync ğŸ’–</h2>

<div id="loginDiv">
<input type="email" id="email" placeholder="Email"><br>
<input type="password" id="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
</div>

<div id="appDiv" style="display:none;">

<!-- HOME -->
<div id="home" class="section active">
<h3 id="welcome"></h3>
<p id="statusText"></p>
<p id="daysTogether"></p>
<p id="birthdaySoon"></p>
</div>

<!-- CHAT -->
<div id="chat" class="section">
<div id="chatBox"></div>
<input type="text" id="message" placeholder="Type message">
<button onclick="sendMessage()">Send</button>
</div>

<!-- DATES -->
<div id="dates" class="section">
<h3>Important Dates</h3>
<p>ğŸ’– Anniversary: 25-11-2023</p>
<p>ğŸ‚ Pooja Birthday: 19-02-2005</p>
<p>ğŸ‚ Kumar Birthday: 07-12-2004</p>
</div>

<!-- CELEBRATION -->
<div id="celebration" class="section">
<h3>ğŸ‰ Celebration ğŸ‰</h3>
<button onclick="cutCake()">ğŸ‚ Cut Cake</button>
<button onclick="blastBalloon()">ğŸˆ Blast Balloon</button>
<p id="celebrateStatus"></p>
</div>

<div class="bottomNav">
<button onclick="showSection('home')">Home</button>
<button onclick="showSection('chat')">Chat</button>
<button onclick="showSection('dates')">Dates</button>
<button onclick="showSection('celebration')">Celebrate</button>
<button onclick="logout()">Logout</button>
</div>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyDEl579k9r9NxIVss_QtQTNLoa25CGGSbI",
authDomain: "notesync-5e7ed.firebaseapp.com",
projectId: "notesync-5e7ed",
storageBucket: "notesync-5e7ed.firebasestorage.app",
messagingSenderId: "486342879531",
appId: "1:486342879531:web:76ed522f873d1ecca67d6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const allowedUsers = {
"kumaraswamyd2005@gmail.com":"Kumaraswamy â¤ï¸",
"poojaprasanna089@gmail.com":"Pooja â¤ï¸"
};

let soulmateOnline = false;

window.login = function(){
const email=document.getElementById("email").value;
const password=document.getElementById("password").value;

if(!allowedUsers[email]){
alert("Not allowed user");
return;
}

signInWithEmailAndPassword(auth,email,password)
.catch(err=>alert(err.message));
}

window.logout = function(){
signOut(auth);
}

window.showSection = function(id){
document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

window.sendMessage = async function(){
const message=document.getElementById("message").value;
if(message==="") return;

await addDoc(collection(db,"messages"),{
text:message,
user:allowedUsers[auth.currentUser.email],
time:Date.now()
});

document.getElementById("message").value="";
}

window.cutCake = async function(){
if(!soulmateOnline){
alert("Your soulmate must be online â¤ï¸");
return;
}
alert("ğŸ‚ Cake Cut Together â¤ï¸");
}

window.blastBalloon = function(){
if(!soulmateOnline){
alert("Your soulmate must be online â¤ï¸");
return;
}
alert("ğŸˆ Balloon Blasted Together â¤ï¸");
}

function calculateDays(){
const start=new Date("2023-11-25");
const now=new Date();
const diff=Math.floor((now-start)/(1000*60*60*24));
return diff;
}

onAuthStateChanged(auth,user=>{
if(user){
loginDiv.style.display="none";
appDiv.style.display="block";

document.getElementById("welcome").innerText=
"Welcome "+allowedUsers[user.email];

document.getElementById("daysTogether").innerText=
"You completed "+calculateDays()+" days together â¤ï¸";

setDoc(doc(db,"status",user.email),{
online:true
});

onSnapshot(collection(db,"status"),snapshot=>{
snapshot.forEach(docSnap=>{
if(docSnap.id!==user.email){
soulmateOnline=docSnap.data().online;
document.getElementById("statusText").innerHTML=
soulmateOnline?
"<span class='online'>Your Soulmate is Online ğŸ’š</span>"
:"<span class='offline'>Your Soulmate is Offline â¤ï¸</span>";
}
});
});

const q=query(collection(db,"messages"),orderBy("time"));
onSnapshot(q,snapshot=>{
chatBox.innerHTML="";
snapshot.forEach(doc=>{
let msg=doc.data();
chatBox.innerHTML+=`<p><b>${msg.user}:</b> ${msg.text}</p>`;
});
});

}else{
loginDiv.style.display="block";
appDiv.style.display="none";
}
});

</script>
</body>
</html>
