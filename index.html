<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NoteSync ğŸ’–</title>

<style>
body{
  margin:0;
  font-family: Arial;
  background: linear-gradient(135deg,#ff758c,#ff7eb3);
  color:white;
}

.container{
  padding:20px;
  padding-bottom:80px;
  text-align:center;
}

input,button,select{
  padding:10px;
  margin:5px;
  border-radius:8px;
  border:none;
}

button{
  background:#ff4d6d;
  color:white;
  cursor:pointer;
}

.section{ display:none; }

#chatBox{
  height:250px;
  overflow-y:auto;
  background:white;
  color:black;
  padding:10px;
  border-radius:10px;
}

#dashboardCard{
  background: rgba(255,255,255,0.2);
  padding:15px;
  border-radius:15px;
  backdrop-filter: blur(10px);
}

/* Bottom Navigation */
.bottomNav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#ff4d6d;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}

.bottomNav button{
  background:none;
  border:none;
  color:white;
  font-size:14px;
}
</style>
</head>

<body>

<div class="container">

<h2>ğŸ’– NoteSync ğŸ’–</h2>

<!-- LOGIN -->
<div id="loginDiv">
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
</div>

<!-- MAIN APP -->
<div id="mainDiv" style="display:none;">

  <!-- HOME -->
  <div id="home" class="section">

    <div id="dashboardCard">
      <h3 id="welcome"></h3>
      <h4>Kumaraswamy ğŸ’™ & Pooja ğŸ’–</h4>
      <p id="soulmateStatus"></p>
      <p id="countdownText"></p>
      <p id="daysTogether"></p>
      <p>ğŸ’ Together Since: 25-11-2023</p>
    </div>

  </div>

  <!-- CHAT -->
  <div id="chat" class="section">
    <div id="chatBox"></div>
    <input type="text" id="messageInput" placeholder="Type message">
    <button onclick="sendMessage()">Send</button>
  </div>

  <!-- DATES -->
  <div id="dates" class="section">
    <input type="text" id="dateTitle" placeholder="Event Name">
    <input type="date" id="dateValue">
    <button onclick="addDate()">Save</button>
    <div id="dateList"></div>
  </div>

  <!-- CELEBRATION -->
  <div id="celebration" class="section">
    <input type="text" id="celebrateText" placeholder="Write something special">
    <button onclick="addCelebration()">Add</button>
    <div id="celebrationList"></div>
  </div>

</div>

</div>

<!-- Bottom Navigation -->
<div class="bottomNav" id="bottomNav" style="display:none;">
  <button onclick="showSection('home')">ğŸ  Home</button>
  <button onclick="showSection('chat')">ğŸ’¬ Chat</button>
  <button onclick="showSection('dates')">ğŸ“… Dates</button>
  <button onclick="showSection('celebration')">ğŸ‰ Celebrate</button>
  <button onclick="logout()">ğŸšª Logout</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { 
  getFirestore, collection, addDoc, onSnapshot, query, orderBy
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEl579k9r9NxIVss_QtQTNLoa25CGGSbI",
  authDomain: "notesync-5e7ed.firebaseapp.com",
  projectId: "notesync-5e7ed",
  storageBucket: "notesync-5e7ed.firebasestorage.app",
  messagingSenderId: "486342879531",
  appId: "1:486342879531:web:76ed522f873d1ecca67d6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const allowedUsers = {
  "kumaraswamyd2005@gmail.com": "Kumaraswamy ğŸ’™",
  "poojaprasanna089@gmail.com": "Pooja ğŸ’–"
};

window.login = async function(){
  const email = email.value.trim();
  const password = password.value.trim();

  if(!allowedUsers[email]){
    alert("Access Denied âŒ");
    return;
  }

  try{
    await signInWithEmailAndPassword(auth,email,password);
  }catch{
    alert("Wrong Email or Password âŒ");
  }
}

window.logout = function(){ signOut(auth); }

onAuthStateChanged(auth,user=>{
  if(user && allowedUsers[user.email]){
    loginDiv.style.display="none";
    mainDiv.style.display="block";
    bottomNav.style.display="flex";
    welcome.innerText="Welcome "+allowedUsers[user.email];
    showSection("home");
    updateDashboard();
  }else{
    loginDiv.style.display="block";
    mainDiv.style.display="none";
    bottomNav.style.display="none";
  }
});

function updateDashboard(){
  const today=new Date();
  const startDate=new Date("2023-11-25");
  const diffDays=Math.floor((today-startDate)/(1000*60*60*24));
  daysTogether.innerText="ğŸ’ Days Together: "+diffDays+" days";

  const kumarBD=new Date(today.getFullYear(),1,19);
  const poojaBD=new Date(today.getFullYear(),11,7);
  if(today>kumarBD) kumarBD.setFullYear(today.getFullYear()+1);
  if(today>poojaBD) poojaBD.setFullYear(today.getFullYear()+1);
  const nextBD=kumarBD<poojaBD?kumarBD:poojaBD;
  const name=kumarBD<poojaBD?"Kumaraswamy":"Pooja";
  const days=Math.ceil((nextBD-today)/(1000*60*60*24));
  countdownText.innerText="ğŸ‚ Next Birthday: "+name+" in "+days+" days ğŸ’•";
}

window.sendMessage = async function(){
  if(messageInput.value==="") return;
  await addDoc(collection(db,"messages"),{
    text:messageInput.value,
    user:allowedUsers[auth.currentUser.email],
    time:Date.now()
  });
  messageInput.value="";
};

const q=query(collection(db,"messages"),orderBy("time"));
onSnapshot(q,snap=>{
  chatBox.innerHTML="";
  snap.forEach(doc=>{
    const msg=doc.data();
    chatBox.innerHTML+=`<p><b>${msg.user}:</b> ${msg.text}</p>`;
  });
  chatBox.scrollTop=chatBox.scrollHeight;
});

window.addCelebration=async function(){
  if(celebrateText.value==="") return;
  await addDoc(collection(db,"celebrations"),{text:celebrateText.value});
  celebrateText.value="";
};

onSnapshot(collection(db,"celebrations"),snap=>{
  celebrationList.innerHTML="";
  snap.forEach(doc=>{
    celebrationList.innerHTML+=`<p>ğŸ’– ${doc.data().text}</p>`;
  });
});

window.addDate=async function(){
  if(dateTitle.value===""||dateValue.value==="") return;
  await addDoc(collection(db,"dates"),{
    title:dateTitle.value,
    date:dateValue.value
  });
  dateTitle.value=""; dateValue.value="";
};

onSnapshot(collection(db,"dates"),snap=>{
  dateList.innerHTML="";
  snap.forEach(doc=>{
    dateList.innerHTML+=`<p>ğŸ“… ${doc.data().title} - ${doc.data().date}</p>`;
  });
});

window.showSection=function(id){
  document.querySelectorAll(".section").forEach(sec=>sec.style.display="none");
  document.getElementById(id).style.display="block";
};

</script>
</body>
</html>
