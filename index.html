<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NoteSync ğŸ’– Ultra</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: Arial;
  background: linear-gradient(135deg,#ff758c,#ff7eb3);
  color:white;
  text-align:center;
}

.section{ display:none; padding:15px; }
.active{ display:block; }

.card{
  background:white;
  color:black;
  padding:15px;
  margin:15px;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.3);
}

input,button{
  padding:8px;
  margin:5px;
  border-radius:8px;
  border:none;
}

button{
  background:#ff4d6d;
  color:white;
  cursor:pointer;
  font-weight:bold;
}

#chatBox{
  height:250px;
  overflow-y:auto;
  background:white;
  color:black;
  padding:10px;
  border-radius:10px;
  text-align:left;
}

.bottomNav{
  position:fixed;
  bottom:0;
  width:100%;
  background:#ff4d6d;
  padding:10px;
  display:flex;
  justify-content:space-around;
}
.bottomNav button{
  background:white;
  color:#ff4d6d;
}

.ultraMode{
  animation: rainbow 5s infinite alternate;
}
@keyframes rainbow{
  0%{background:#ff758c;}
  100%{background:#ff00aa;}
}
</style>
</head>
<body>

<h2>ğŸ’– NoteSync Ultra ğŸ’–</h2>

<div id="loginDiv">
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button id="loginBtn">Login</button>
</div>

<div id="mainDiv" style="display:none; padding-bottom:70px;">

<!-- HOME -->
<div id="home" class="section active">
  <div class="card">
    <h2>ğŸ’™ Kumaraswamy â¤ï¸ Pooja ğŸ’–</h2>
    <p id="soulStatus"></p>
  </div>
  <div class="card">
    <h3>ğŸ‚ Birthdays</h3>
    <p id="birthdayCountdown"></p>
  </div>
  <div class="card">
    <h3>ğŸ’ Anniversary</h3>
    <p id="anniCountdown"></p>
  </div>
  <div class="card">
    <h3>ğŸ’ Days Together</h3>
    <p id="daysTogether"></p>
  </div>
</div>

<!-- CHAT -->
<div id="chat" class="section">
  <div id="chatBox"></div>
  <input type="text" id="messageInput" placeholder="Type message">
  <button id="sendBtn">Send</button>
</div>

<!-- CELEBRATION -->
<div id="celebration" class="section">
  <div class="card">
    <h3>ğŸ‰ Ultra Celebration</h3>
    <button onclick="celebrate()">Cut Cake ğŸ‚</button>
    <p id="celebrateMsg"></p>
  </div>
</div>

</div>

<div class="bottomNav" id="navBar" style="display:none;">
<button onclick="showSection('home')">ğŸ </button>
<button onclick="showSection('chat')">ğŸ’¬</button>
<button onclick="showSection('celebration')">ğŸ‰</button>
<button id="logoutBtn">ğŸšª</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* YOUR CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyDEl579k9r9NxIVss_QtQTNLoa25CGGSbI",
  authDomain: "notesync-5e7ed.firebaseapp.com",
  projectId: "notesync-5e7ed",
  storageBucket: "notesync-5e7ed.firebasestorage.app",
  messagingSenderId: "486342879531",
  appId: "1:486342879531:web:76ed522f873d1ecca67d6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let bothOnline=false;

/* LOGIN */
loginBtn.onclick=async()=>{
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
  }catch(e){ alert(e.message); }
};

logoutBtn.onclick=()=>signOut(auth);

/* AUTH */
onAuthStateChanged(auth,user=>{
  if(user){
    loginDiv.style.display="none";
    mainDiv.style.display="block";
    navBar.style.display="flex";

    setDoc(doc(db,"status",user.uid),{
      online:true,
      email:user.email
    });

    onSnapshot(collection(db,"status"),snap=>{
      let onlineCount=0;
      snap.forEach(d=>{ if(d.data().online) onlineCount++; });
      bothOnline = onlineCount>=2;
      soulStatus.innerHTML=bothOnline?
      "ğŸŸ¢ Both Online ğŸ’–":
      "ğŸ”´ Waiting for soulmate...";
    });

    loadChat();
    updateDashboard();
  }
});

/* DASHBOARD */
const myBirthday=new Date("2005-02-19");
const herBirthday=new Date("2004-12-07");
const anniversary=new Date("2023-11-25");

function countdown(date){
  let now=new Date();
  let next=new Date(now.getFullYear(),date.getMonth(),date.getDate());
  if(next<now) next.setFullYear(now.getFullYear()+1);
  return Math.ceil((next-now)/(1000*60*60*24));
}

function updateDashboard(){
  birthdayCountdown.innerHTML=
  `Kumaraswamy: ${countdown(myBirthday)} days <br>
   Pooja: ${countdown(herBirthday)} days`;

  anniCountdown.innerHTML=`${countdown(anniversary)} days left`;
  daysTogether.innerHTML=
  `${Math.floor((new Date()-anniversary)/(1000*60*60*24))} days ğŸ’`;
}

/* REAL TIME CHAT */
sendBtn.onclick=async()=>{
  if(messageInput.value==="") return;
  await addDoc(collection(db,"messages"),{
    text:messageInput.value,
    email:auth.currentUser.email,
    time:Date.now()
  });
  messageInput.value="";
};

function loadChat(){
  onSnapshot(query(collection(db,"messages"),orderBy("time")),snap=>{
    chatBox.innerHTML="";
    snap.forEach(d=>{
      let m=d.data();
      chatBox.innerHTML+=`
      <p>
      <b>${m.email}:</b> ${m.text}
      ${m.email===auth.currentUser.email?
      `<button onclick="deleteMessage('${d.id}')">ğŸ—‘</button>`:""}
      </p>`;
    });
    chatBox.scrollTop=chatBox.scrollHeight;
  });
}

window.deleteMessage=id=>deleteDoc(doc(db,"messages",id));

/* CELEBRATION */
window.celebrate=()=>{
  if(!bothOnline){
    celebrateMsg.innerHTML="âŒ Both must be online!";
    return;
  }
  document.body.classList.add("ultraMode");
  celebrateMsg.innerHTML="ğŸ‚ Cake Cut Successfully ğŸ’–ğŸ”¥";
};

window.showSection=id=>{
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

</script>
</body>
</html>
