<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NoteSync ğŸ’–</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: Arial;
  background: linear-gradient(135deg,#ff758c,#ff7eb3);
  color:white;
  text-align:center;
}

.section{ display:none; padding:15px; }
.active{ display:block; }

.card{
  background:white;
  color:black;
  padding:15px;
  margin:10px;
  border-radius:15px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
}

input,button{
  padding:8px;
  margin:5px;
  border-radius:8px;
  border:none;
}

button{
  background:#ff4d6d;
  color:white;
  cursor:pointer;
}

#chatBox{
  height:250px;
  overflow-y:auto;
  background:white;
  color:black;
  padding:10px;
  border-radius:10px;
}

.bottomNav{
  position:fixed;
  bottom:0;
  width:100%;
  background:#ff4d6d;
  padding:10px;
  display:flex;
  justify-content:space-around;
}
.bottomNav button{
  background:white;
  color:#ff4d6d;
  font-weight:bold;
}
</style>
</head>
<body>

<h2>ğŸ’– NoteSync ğŸ’–</h2>

<div id="loginDiv">
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button id="loginBtn">Login</button>
</div>

<div id="mainDiv" style="display:none; padding-bottom:70px;">

<!-- HOME -->
<div id="home" class="section active">
  <div class="card">
    <h2 id="coupleNames"></h2>
    <p id="soulStatus"></p>
  </div>

  <div class="card">
    <h3>ğŸ‚ Birthdays</h3>
    <p id="birthdayCountdown"></p>
  </div>

  <div class="card">
    <h3>ğŸ’ Anniversary</h3>
    <p id="anniCountdown"></p>
  </div>

  <div class="card">
    <h3>ğŸ’ Days Together</h3>
    <p id="daysTogether"></p>
  </div>
</div>

<!-- CHAT -->
<div id="chat" class="section">
  <div id="chatBox"></div>
  <input type="text" id="messageInput" placeholder="Type message">
  <button id="sendBtn">Send</button>
</div>

<!-- IMPORTANT DATES -->
<div id="dates" class="section">
  <div class="card">
    <input type="text" id="eventTitle" placeholder="Event Name">
    <input type="date" id="eventDate">
    <button onclick="addEvent()">Add</button>
    <div id="eventList"></div>
  </div>
</div>

<!-- CELEBRATION -->
<div id="celebration" class="section">
  <div class="card">
    <h3>ğŸ‰ Celebration</h3>
    <button onclick="celebrate()">Cut Cake ğŸ‚</button>
    <p id="celebrateMsg"></p>
  </div>
</div>

<!-- SECRET BOX -->
<div id="secret" class="section">
  <div class="card">
    <input type="text" id="secretText" placeholder="Write special message">
    <button onclick="addSecret()">Save</button>
    <div id="secretList"></div>
  </div>
</div>

</div>

<div class="bottomNav" id="navBar" style="display:none;">
<button onclick="showSection('home')">ğŸ </button>
<button onclick="showSection('chat')">ğŸ’¬</button>
<button onclick="showSection('dates')">ğŸ“…</button>
<button onclick="showSection('celebration')">ğŸ‰</button>
<button onclick="showSection('secret')">ğŸ’Œ</button>
<button id="logoutBtn">ğŸšª</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEl579k9r9NxIVss_QtQTNLoa25CGGSbI",
  authDomain: "notesync-5e7ed.firebaseapp.com",
  projectId: "notesync-5e7ed",
  storageBucket: "notesync-5e7ed.firebasestorage.app",
  messagingSenderId: "486342879531",
  appId: "1:486342879531:web:76ed522f873d1ecca67d6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const allowedUsers={
  "kumaraswamyd2005@gmail.com":"Kumaraswamy ğŸ’™",
  "poojaprasanna089@gmail.com":"Pooja ğŸ’–"
};

/* LOGIN */
loginBtn.onclick=async()=>{
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
  }catch(e){ alert(e.message); }
};

logoutBtn.onclick=()=>signOut(auth);

/* AUTH STATE */
onAuthStateChanged(auth,user=>{
  if(user && allowedUsers[user.email]){
    loginDiv.style.display="none";
    mainDiv.style.display="block";
    navBar.style.display="flex";
    coupleNames.innerHTML="ğŸ’™ Kumaraswamy â¤ï¸ Pooja ğŸ’–";
    updateDashboard();

    setDoc(doc(db,"status",user.uid),{online:true,email:user.email});

    onSnapshot(collection(db,"status"),snap=>{
      let online=false;
      snap.forEach(d=>{
        if(d.data().email!==user.email && d.data().online) online=true;
      });
      soulStatus.innerHTML=online?
      "ğŸŸ¢ Your soulmate is Online ğŸ’–":
      "ğŸ”´ Your soulmate is Offline";
    });

  }else{
    loginDiv.style.display="block";
    mainDiv.style.display="none";
    navBar.style.display="none";
  }
});

/* DASHBOARD */
const myBirthday=new Date("2005-02-19");
const herBirthday=new Date("2004-12-07");
const anniversary=new Date("2023-11-25");

function countdown(date){
  let now=new Date();
  let next=new Date(now.getFullYear(),date.getMonth(),date.getDate());
  if(next<now) next.setFullYear(now.getFullYear()+1);
  return Math.ceil((next-now)/(1000*60*60*24));
}

function updateDashboard(){
  birthdayCountdown.innerHTML=
  `Kumaraswamy: ${countdown(myBirthday)} days <br>
   Pooja: ${countdown(herBirthday)} days`;

  anniCountdown.innerHTML=`${countdown(anniversary)} days left`;

  let days=Math.floor((new Date()-anniversary)/(1000*60*60*24));
  daysTogether.innerHTML=`${days} days`;
}

/* CHAT */
sendBtn.onclick=async()=>{
  if(messageInput.value==="") return;
  await addDoc(collection(db,"messages"),{
    text:messageInput.value,
    user:allowedUsers[auth.currentUser.email],
    email:auth.currentUser.email,
    time:Date.now()
  });
  messageInput.value="";
};

onSnapshot(query(collection(db,"messages"),orderBy("time")),snap=>{
  chatBox.innerHTML="";
  snap.forEach(d=>{
    let m=d.data();
    chatBox.innerHTML+=`
    <p>
    <b>${m.user}:</b> ${m.text}
    ${m.email===auth.currentUser.email?
    `<button onclick="deleteMessage('${d.id}')">ğŸ—‘</button>`:""}
    </p>`;
  });
});

window.deleteMessage=id=>deleteDoc(doc(db,"messages",id));

/* IMPORTANT DATES */
window.addEvent=async()=>{
  if(eventTitle.value===""||eventDate.value==="") return;
  await addDoc(collection(db,"dates"),{
    title:eventTitle.value,
    date:eventDate.value
  });
  eventTitle.value=""; eventDate.value="";
};

onSnapshot(collection(db,"dates"),snap=>{
  eventList.innerHTML="";
  snap.forEach(d=>{
    eventList.innerHTML+=`
    <p>${d.data().title} - ${d.data().date}
    <button onclick="deleteDoc(doc(db,'dates','${d.id}'))">ğŸ—‘</button>
    </p>`;
  });
});

/* SECRET BOX */
window.addSecret=async()=>{
  if(secretText.value==="") return;
  await addDoc(collection(db,"secret"),{
    text:secretText.value
  });
  secretText.value="";
};

onSnapshot(collection(db,"secret"),snap=>{
  secretList.innerHTML="";
  snap.forEach(d=>{
    secretList.innerHTML+=`<p>ğŸ’Œ ${d.data().text}</p>`;
  });
});

/* CELEBRATION */
window.celebrate=()=>{
  celebrateMsg.innerHTML="ğŸ‚ Cake Cut! ğŸ‰ Love Forever ğŸ’–";
};

window.showSection=id=>{
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

</script>
</body>
</html>
